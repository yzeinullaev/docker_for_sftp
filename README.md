# SFTP Docker Server

–≠—Ç–æ—Ç –ø—Ä–æ–µ–∫—Ç —Å–æ–∑–¥–∞–µ—Ç Docker-–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä —Å SFTP —Å–µ—Ä–≤–µ—Ä–æ–º, –Ω–∞—Å—Ç—Ä–æ–µ–Ω–Ω—ã–º –¥–ª—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ —á–µ—Ä–µ–∑ SSH –∫–ª—é—á–∏.

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### 1. –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –∑–∞–ø—É—Å–∫

```bash
# –ö–ª–æ–Ω–∏—Ä—É–π—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
git clone <your-repo-url>
cd SFTPDocker

# –ó–∞–ø—É—Å–∫ Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
docker-compose up -d --build
```

### 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è

```bash
# –¢–µ—Å—Ç–æ–≤–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —á–µ—Ä–µ–∑ SFTP
sftp -P 2222 -i keys/id_rsa sftpuser@localhost
```

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
SFTPDocker/
‚îú‚îÄ‚îÄ docker-compose.yml      # Docker Compose –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îú‚îÄ‚îÄ Dockerfile             # Docker –æ–±—Ä–∞–∑ –¥–ª—è SFTP —Å–µ—Ä–≤–µ—Ä–∞
‚îú‚îÄ‚îÄ config/
‚îÇ   ‚îî‚îÄ‚îÄ sshd_config        # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è SSH —Å–µ—Ä–≤–µ—Ä–∞
‚îú‚îÄ‚îÄ scripts/
‚îÇ   ‚îî‚îÄ‚îÄ start.sh           # –°—Ç–∞—Ä—Ç–æ–≤—ã–π —Å–∫—Ä–∏–ø—Ç –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
‚îú‚îÄ‚îÄ keys/
‚îÇ   ‚îú‚îÄ‚îÄ id_rsa             # –ü—Ä–∏–≤–∞—Ç–Ω—ã–π –∫–ª—é—á
‚îÇ   ‚îî‚îÄ‚îÄ id_rsa.pub         # –ü—É–±–ª–∏—á–Ω—ã–π –∫–ª—é—á
‚îú‚îÄ‚îÄ data/                  # –î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è –¥–ª—è —Ñ–∞–π–ª–æ–≤ (–º–æ–Ω—Ç–∏—Ä—É–µ—Ç—Å—è –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä)
‚îú‚îÄ‚îÄ logs/                  # –õ–æ–≥–∏ —Å–µ—Ä–≤–µ—Ä–∞
‚îî‚îÄ‚îÄ laravel-sftp-example.php # –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤ Laravel
```

## ‚öôÔ∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### SFTP —Å–µ—Ä–≤–µ—Ä
- **–ü–æ—Ä—Ç**: 2222 (–º–∞–ø–ø–∏—Ç—Å—è –Ω–∞ 22 –≤–Ω—É—Ç—Ä–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞)
- **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å**: sftpuser
- **–ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è**: –¢–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ SSH –∫–ª—é—á–∏ (–ø–∞—Ä–æ–ª–∏ –æ—Ç–∫–ª—é—á–µ–Ω—ã)
- **Chroot**: /home/sftpuser (–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω —ç—Ç–æ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–µ–π)
- **–ó–∞–≥—Ä—É–∑–∫–∏**: /home/sftpuser/upload

### Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
- **–ë–∞–∑–æ–≤—ã–π –æ–±—Ä–∞–∑**: Ubuntu 22.04
- **–û—Ç–∫—Ä—ã—Ç—ã–µ –ø–æ—Ä—Ç—ã**: 2222:22
- **–ü—Ä–∏–º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏**:
  - `./data` ‚Üí `/home/sftpuser/upload`
  - `./logs` ‚Üí `/var/log`

## üîê –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∫–ª—é—á–µ–π

### –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –Ω–æ–≤—ã—Ö –∫–ª—é—á–µ–π (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

```bash
# –í Windows PowerShell –∏–ª–∏ Linux/Mac terminal
ssh-keygen -t rsa -b 4096 -f keys/id_rsa -N ""
```

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –ø—É–±–ª–∏—á–Ω–æ–≥–æ –∫–ª—é—á–∞

1. –ó–∞–º–µ–Ω–∏—Ç–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ `keys/id_rsa.pub` –Ω–∞ –≤–∞—à –ø—É–±–ª–∏—á–Ω—ã–π –∫–ª—é—á
2. –ü–µ—Ä–µ—Å–æ–±–µ—Ä–∏—Ç–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä:
```bash
docker-compose down
docker-compose up -d --build
```

## üíª –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Å Laravel

### 1. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

```bash
composer require phpseclib/phpseclib
```

### 2. –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–ª—é—á–µ–π

```bash
# –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –ø—Ä–∏–≤–∞—Ç–Ω—ã–π –∫–ª—é—á –≤ Laravel –ø—Ä–æ–µ–∫—Ç
cp keys/id_rsa /path/to/laravel/storage/keys/
```

### 3. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

–°–º. —Ñ–∞–π–ª `laravel-sftp-example.php` –¥–ª—è –ø–æ–ª–Ω–æ–≥–æ –ø—Ä–∏–º–µ—Ä–∞ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏.

```php
$sftpService = new SFTPService();
$sftpService->connect();
$sftpService->uploadFile('/local/path/file.txt', '/upload/file.txt');
```

## üõ†Ô∏è –ö–æ–º–∞–Ω–¥—ã Docker

```bash
# –ó–∞–ø—É—Å–∫ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
docker-compose up -d

# –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
docker-compose down

# –ü–µ—Ä–µ—Å–±–æ—Ä–∫–∞ –æ–±—Ä–∞–∑–∞
docker-compose up -d --build

# –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤
docker-compose logs -f

# –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—É
docker exec -it sftp-docker-server bash
```

## üìù –õ–æ–≥–∏ –∏ –æ—Ç–ª–∞–¥–∫–∞

```bash
# –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤ SFTP —Å–µ—Ä–≤–µ—Ä–∞
docker-compose logs sftp-server

# –õ–æ–≥–∏ SSH –¥–µ–º–æ–Ω–∞ –≤–Ω—É—Ç—Ä–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
docker exec sftp-docker-server tail -f /var/log/auth.log
```

## üîç –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è

### –ß–µ—Ä–µ–∑ –∫–æ–º–∞–Ω–¥–Ω—É—é —Å—Ç—Ä–æ–∫—É

```bash
# SFTP –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ
sftp -P 2222 -i keys/id_rsa sftpuser@localhost

# SCP –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ
scp -P 2222 -i keys/id_rsa localfile.txt sftpuser@localhost:/upload/
```

### –ß–µ—Ä–µ–∑ Laravel

```bash
# –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤–æ–π –∫–æ–º–∞–Ω–¥—ã
php artisan sftp:test
```

## üö® –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- ‚úÖ –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è —Ç–æ–ª—å–∫–æ –ø–æ –∫–ª—é—á–∞–º
- ‚úÖ –û—Ç–∫–ª—é—á–µ–Ω–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –ø–æ –ø–∞—Ä–æ–ª—é
- ‚úÖ Chroot jail –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- ‚úÖ –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –∫–æ–º–∞–Ω–¥ —Ç–æ–ª—å–∫–æ SFTP
- ‚úÖ –û—Ç–∫–ª—é—á–µ–Ω TCP forwarding
- ‚úÖ –û—Ç–∫–ª—é—á–µ–Ω X11 forwarding

## üîß –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –Ω–µ–ø–æ–ª–∞–¥–æ–∫

### –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –Ω–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è
```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ—à–∏–±–æ–∫
docker-compose logs

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞
docker-compose ps
```

### –ü—Ä–æ–±–ª–µ–º—ã —Å –∫–ª—é—á–∞–º–∏
```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞ –∫ –∫–ª—é—á–∞–º
ls -la keys/

# –ü—Ä–∞–≤–∞ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å 600 –¥–ª—è –ø—Ä–∏–≤–∞—Ç–Ω–æ–≥–æ –∫–ª—é—á–∞
chmod 600 keys/id_rsa
```

### –û—à–∏–±–∫–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
```bash
# –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —Å –æ—Ç–ª–∞–¥–∫–æ–π
sftp -v -P 2222 -i keys/id_rsa sftpuser@localhost

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
docker exec sftp-docker-server tail -f /var/log/auth.log
```

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ü—Ä–∏ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–∏ –ø—Ä–æ–±–ª–µ–º:

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏: `docker-compose logs`
2. –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –ø–æ—Ä—Ç 2222 —Å–≤–æ–±–æ–¥–µ–Ω: `netstat -an | grep 2222`
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ –∫–ª—é—á–∞–º
4. –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ Docker –∑–∞–ø—É—â–µ–Ω –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç

## üìÑ –õ–∏—Ü–µ–Ω–∑–∏—è

MIT License